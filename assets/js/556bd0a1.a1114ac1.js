"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3987],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return m}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),l=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=l(e.components);return r.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=l(t),m=a,y=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return t?r.createElement(y,i(i({ref:n},c),{},{components:t})):r.createElement(y,i({ref:n},c))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p.mdxType="string"==typeof e?e:a,i[1]=p;for(var l=2;l<o;l++)i[l]=t[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},5704:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return p},metadata:function(){return l},toc:function(){return u}});var r=t(3117),a=t(102),o=(t(7294),t(3905)),i=["components"],p={},s="Letsencrypt",l={unversionedId:"dokku/letsencrypt",id:"dokku/letsencrypt",title:"Letsencrypt",description:"Troubleshooting",source:"@site/docs/dokku/letsencrypt.md",sourceDirName:"dokku",slug:"/dokku/letsencrypt",permalink:"/synopsis/dokku/letsencrypt",draft:!1,editUrl:"https://github.com/lebalz/blog/edit/main/docs/dokku/letsencrypt.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Drone Runner",permalink:"/synopsis/dokku/drone-ci/drone-runner"},next:{title:"Node RED",permalink:"/synopsis/dokku/node-red/"}},c={},u=[{value:"Troubleshooting",id:"troubleshooting",level:2}],d={toc:u};function m(e){var n=e.components,t=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"letsencrypt"},"Letsencrypt"),(0,o.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,o.kt)("p",null,"When ",(0,o.kt)("inlineCode",{parentName:"p"},"dokku letsencrypt:auto-renew app-name")," fails"),(0,o.kt)("admonition",{title:"ERROR",type:"danger"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'2022-01-22 07:42:43,377:ERROR:__main__:1388: CA marked some of the authorizations as\n    invalid, which likely means it could not access http://example.com/.well-known/acme-challenge/X.\n    Did you set correct path in -d example.com:path or --default_root? Are all your domains\n    accessible from the internet? Please check your domains\' DNS entries, your host\'s\n    network/firewall setup and your webserver config. If a domain\'s DNS entry has both A\n    and AAAA fields set up, some CAs such as Let\'s Encrypt will perform the challenge\n    validation over IPv6. If your DNS provider does not answer correctly to CAA records\n    request, Let\'s Encrypt won\'t issue a certificate for your domain (see \n    https://letsencrypt.org/docs/caa/). Failing authorizations:\n    https://acme-v02.api.letsencrypt.org/acme/authz-v3/70727888570\nTraceback (most recent call last):\n  File "/simp_le/simp_le.py", line 1551, in main\n    return main_with_exceptions(cli_args)\n  File "/simp_le/simp_le.py", line 1535, in main_with_exceptions\n    persist_new_data(args, existing_data)\n  File "/simp_le/simp_le.py", line 1456, in persist_new_data\n    chain=None,\n  File "/simp_le/simp_le.py", line 1124, in persist_data\n    plugin.save(new_data)\n  File "/simp_le/simp_le.py", line 648, in save\n    pems = [self.dump_cert(data.cert)]\n  File "/simp_le/simp_le.py", line 468, in dump_cert\n    return OpenSSL.crypto.dump_certificate(self.typ, data.wrapped).strip()\nAttributeError: \'NoneType\' object has no attribute \'wrapped\'\n\nUnhandled error has happened, traceback is above\n'))),(0,o.kt)("p",null,"and even ",(0,o.kt)("inlineCode",{parentName:"p"},"dokku letsencrypt:revoke app-name")," fails "),(0,o.kt)("admonition",{title:"ERROR",type:"danger"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"-----\x3e Revoking letsencrypt certificate for app-name...\n        - Domain 'domain.com'\ndarkhttpd/1.12, copyright (c) 2003-2016 Emil Mikulic.\nlistening on: http://0.0.0.0:80/\nACME server returned an error: urn:ietf:params:acme:error:unauthorized :: The client lacks sufficient authorization :: Certificate is expired\n\n\nDebugging tips: -v improves output verbosity. Help is available under --help.\n"))),(0,o.kt)("p",null,"(and ",(0,o.kt)("inlineCode",{parentName:"p"},"dokku letsencrypt:cleanup app-name")," does not help), then an easy trick will do the job:"),(0,o.kt)("admonition",{title:"Readd the domain",type:"success"},(0,o.kt)("p",{parentName:"admonition"},"Remove your current domain since this will cleanup and remove the broken certificates.\nThen add it again and run letsencrypt for the win:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"dokku domains:report app-name\n\ndokku domains:remove app-name domain.com\ndokku domains:add app-name domain.com\n\ndokku letsencrypt app-name\n"))))}m.isMDXComponent=!0}}]);